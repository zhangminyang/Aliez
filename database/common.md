# Mysql 

## 存储引擎
* InnoDB存储引擎
InnoDB是mysql的默认引擎，
支持事务处理，支持外键，支持崩溃修复能力和并发控制。如果需要对事务的完整性要求比较高（比如银行），要求实现并发控制（比如售票），那选择InnoDB有很大的优势。如果需要频繁的更新、删除操作的数据库，也可以选择InnoDB，因为支持事务的提交（commit）和回滚（rollback）。
InnoDB通过多版本的并发控制来获得高并发性，并且实现了SQL标准的四种隔离级别，同时使用next-keylocking的策略来避免幻读的产生，除此之外，InnoDB支持插入缓冲，二次写，自适应哈希索引，预读等高性能和高可用功能。
* MyISAM存储引擎
不支持事务、表锁设计、支持全文索引
插入数据快，空间和内存使用比较低。如果表主要是用于插入新记录和读出记录，那么选择MyISAM能实现处理高效率。如果应用的完整性、并发性要求比 较低，也可以使用。如果数据表主要用来插入和查询记录，则MyISAM引擎能提供较高的处理效率


## 事务

数据库事务(Database Transaction) ，是指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。 事务处理可以确保除非事务性单元内的所有操作都成功完成，否则不会永久更新面向数据的资源。通过将一组相关操作组合为一个要么全部成功要么全部失败的单元，可以简化错误恢复并使应用程序更加可靠。一个逻辑工作单元要成为事务，必须满足所谓的ACID（原子性、一致性、隔离性和持久性）属性。事务是数据库运行中的逻辑工作单位，由DBMS中的事务管理子系统负责事务的处理。
### 特性（ACID）

1. 原子性
   原子性是指事务包含的所有操作要么全部成功，要么全部失败回滚，因此事务的操作如果成功就必须要完全应用到数据库，如果操作失败则不能对数据库有任何影响。
2. 一致性
   一致性是指事务必须使数据库从一个一致性状态变换到另一个一致性状态，也就是说一个事务执行之前和执行之后都必须处于一致性状态。
3. 隔离性
   隔离性是当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离。
4. 持久性
   持久性是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。

### 事务隔离级别
可能发生的问题
* 脏读 读取到其他事务未提交的内容 
* 不可重复读 两次重复读取数据不一致，原因是读取期间其他事务修改了数据。
* 幻读 一个事务读取了几行数据，接着另一个事务插入/删除了数据，在随后的查询中，第一个事务会发现一些原本不存在的数据，就好像发生了幻觉一样。


1. READ UNCOMMITTED（读未提交） 可以读取到未提交的事务 什么都不能解决
2. READ COMMITED（读已提交） 只能读取到已经提交的事务，可以防止脏读的发生
3. REPEATABLE READ （可重复读）保证两次重复读取的数据是一样的 可以防止脏读，不可重复读 但会发生幻读
   *但是要注意，MySQL的默认隔离级别RR使用的是NextKey锁，已经可以防止幻读。*
4. SERIALIZABLE （序列化） 所有事务完全按照顺序执行，读写冲突，并发度急剧下降，可以防止脏读、不可重复度和幻读。


## 索引
索引只根据WHERE后字段进行判断，SELECT后字段只决定哪些字段加载到内存，以及判断是否会使用覆盖索引。

优点：加速查询；减少I/O
缺点：维护索引代价大；会减慢增删改速度；占用空间多

InnoDB支持常见的索引：
* B+索引
* 全文索引
* 哈希索引

### B+树
B+树是通过二叉查找树，再有平衡二叉树，B树演化而来

二叉查找树：左子树的键值总是小于根的键值，右子树的键值总是大于根的键值，因此可以通过中序遍历的到键值的排序输出
平衡二叉树：在二叉查找树的基础上，满足任何节点的两个子树得高度差不超过1，维护平衡二叉树的代价非常大，需要多次旋转来维护平衡性

B+树视为磁盘设置的一种平衡查找树，在B+书中，所有记录节点都是按照键值的大小顺序存放在同一层叶子节点上，由个叶子节点指针进行连接

优点：范围查询十分迅速，IO次数更少（树的高度低）
缺点:空间换时间。

* B+树（MongoDB） vs B树（MySQL）？
首先我们需要知道B+树和B树的两个不同点：
B+树叶子节点有指向相邻叶子节点的指针，所有叶子节点是一条排序单链表
B树所有节点都存储数据，B+树只有叶子节点存储数，这意味着：虽然B+树在单次查找时的平均速度不如B树，但是B+树的查找时间更加稳定和平均，每次查询的耗时都是一样的

### B+索引
* 聚集索引
按照每张表的主键构造一颗B+树，同时叶子节点存放得即为整张表的行记录数据

* 辅助索引 
叶子结点并不包含行记录的所有数据，除了键值外，没个叶子节点中的索引行还包含了一个书签。
书签用来告诉InnoDB存储引擎在哪里可以找到相对应的行数据

在这两类下可以分为四个小类
1，普通索引：最基本的索引，没有任何限制，是我们大多数情况下使用到的索引。

2，唯一索引：与普通索引类型，不同的是唯一索引的列值必须唯一，但允许为空值。

3，全文索引：全文索引（FULLTEXT）仅可以适用于MyISAM引擎的数据表；作用于CHAR、VARCHAR、TEXT数据类型的列。

4，组合索引：将几个列作为一条索引进行检索，使用最左匹配原则。
### B+索引的应用
* 联合索引
指对表上的多个列进行索引，也就是说在B+树中，键值的数量不是1，而是大于等于2

* 覆盖索引 即从附注索引中查询的记录，就不需要从聚集索引中查找

### 自适应哈希索引
采用哈希表的方式实现，不同的是，这仅是数据库自身创建并使用的，对于范围查询无能为力

### 全文检索

